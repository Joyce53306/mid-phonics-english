<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phonics Pronunciation App</title>
    <style>
        :root { --primary: #FF5722; --secondary: #2196F3; --success: #4CAF50; --bg: #FFF9C4; }
        body { font-family: 'Comic Sans MS', sans-serif; text-align: center; background-color: var(--bg); padding: 20px; margin: 0; }
        .container { background: white; max-width: 600px; margin: auto; padding: 25px; border-radius: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); min-height: 80vh; }
        .alphabet-menu { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; }
        .letter-btn { background: white; border: 2px solid var(--secondary); border-radius: 8px; padding: 10px; cursor: pointer; font-size: 18px; width: 45px; }
        .letter-btn:hover { background: var(--secondary); color: white; }
        
        #play-btn { background: var(--primary); color: white; border: none; padding: 15px 30px; font-size: 24px; border-radius: 50px; cursor: pointer; margin: 15px 0; }
        .word-option { background: #E3F2FD; border: 3px solid #64B5F6; padding: 20px; font-size: 26px; border-radius: 15px; cursor: pointer; width: 45%; font-weight: bold; }
        
        #result-area { margin-top: 20px; }
        #big-word { font-size: 70px; color: var(--success); margin: 10px 0; }
        
        /* ÈåÑÈü≥ÊåâÈàïÊ®£Âºè */
        .record-controls { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        .record-btn { background: #f44336; color: white; border: none; width: 80px; height: 80px; border-radius: 50%; font-size: 30px; cursor: pointer; }
        .record-btn:active { background: #b71c1c; transform: scale(0.9); }
        .play-back-btn { background: #2196F3; color: white; border: none; width: 80px; height: 80px; border-radius: 50%; font-size: 30px; cursor: pointer; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <div id="menu-view">
        <h2>Choose a Letter!</h2>
        <div id="menu" class="alphabet-menu"></div>
    </div>

    <div id="game-view" class="hidden">
        <button onclick="location.reload()" style="border:none; background:none; color:gray; cursor:pointer;">‚¨Ö Back</button>
        <h3 id="step-hint">Step 1: Listen!</h3>
        <button id="play-btn" onclick="playSound()">üîä Listen</button>

        <div id="quiz-area">
            <div style="display: flex; justify-content: space-around; margin-top: 20px;">
                <div id="opt1" class="word-option" onclick="checkAnswer(this)"></div>
                <div id="opt2" class="word-option" onclick="checkAnswer(this)"></div>
            </div>
        </div>

        <div id="result-area" class="hidden">
            <div id="star" style="font-size: 60px;">üåü Excellent!</div>
            <div id="big-word"></div>
            <p>Step 3: Record & Listen</p>
            <div class="record-controls">
                <button id="recBtn" class="record-btn" onmousedown="startRecording()" onmouseup="stopRecording()" ontouchstart="startRecording()" ontouchend="stopRecording()">üé§</button>
                <button id="playRecBtn" class="play-back-btn hidden" onclick="playBack()">‚ñ∂Ô∏è</button>
            </div>
            <button onclick="nextRound()" style="margin-top:30px; padding:10px 20px; border-radius:20px; border:1px solid #ccc; cursor:pointer;">Next Word ‚ûî</button>
        </div>
    </div>
</div>

<script>
    const phonicsData = {
        A: ["ant", "alligator", "arrow", "apple", "ax"],
        B: ["bee", "bear", "boy", "bike", "bus", "boat", "bird"],
        C: ["cat", "cap", "cup", "cake", "cow", "computer", "camera", "caterpillar"],
        D: ["dog", "door", "duck", "deer", "donkey", "dinosaur"],
        E: ["egg", "elf", "eggplant", "elephant", "elk"],
        F: ["fish", "fan", "five", "frog", "fox", "fruit"],
        G: ["goat", "girl", "goose", "gift", "gum", "gorilla"],
        H: ["hat", "horse", "hen", "house", "happy", "hand", "hippo", "hut"],
        I: ["ink", "in", "igloo", "iguana", "insect", "indian"],
        J: ["jam", "juice", "jeep", "jet", "jungle", "jellyfish"],
        K: ["kite", "key", "kit", "king", "kangaroo", "koala"],
        L: ["lion", "lamp", "leaf", "lake", "love", "line", "ladybug", "lemon"],
        M: ["mouse", "monkey", "moon", "milk", "mitten", "map"],
        N: ["nut", "net", "nose", "nurse", "number", "nest", "nine"],
        O: ["ox", "olive", "on", "octopus", "otter", "ostrich"],
        P: ["pig", "pen", "pan", "papaya", "penguin", "peas", "piano", "pizza", "puppy"],
        Q: ["queen", "quilt", "quick", "quiet", "quarter", "quiz"],
        R: ["run", "rock", "rabbit", "robot", "rose", "rat", "red", "room"],
        S: ["sun", "socks", "soup", "snail", "star", "snake", "sea", "sandwich"],
        T: ["tiger", "top", "turtle", "ten", "train", "taxi", "tomato", "tent"],
        U: ["up", "under", "uncle", "umbrella", "underwear"],
        V: ["vase", "van", "vet", "vest", "volcano", "violin"],
        W: ["witch", "window", "water", "watermelon", "wolf", "watch", "well", "wagon"],
        X: ["box", "fox", "mix", "six", "T-rex"],
        Y: ["yolk", "yo-yo", "yes", "yawn", "yellow", "yogurt", "yarn"],
        Z: ["zoo", "zebra", "zipper", "zero"]
    };

    let currentLetter = '', currentTarget = '', mediaRecorder, audioChunks = [], audioUrl;

    // ÂàùÂßãÂåñÈÅ∏ÂñÆ
    const menu = document.getElementById('menu');
    Object.keys(phonicsData).forEach(letter => {
        let btn = document.createElement('button');
        btn.innerText = letter; btn.className = 'letter-btn';
        btn.onclick = () => { currentLetter = letter; document.getElementById('menu-view').classList.add('hidden'); document.getElementById('game-view').classList.remove('hidden'); nextRound(); };
        menu.appendChild(btn);
    });

    function nextRound() {
        const words = phonicsData[currentLetter];
        currentTarget = words[Math.floor(Math.random() * words.length)];
        const letters = Object.keys(phonicsData).filter(l => l !== currentLetter);
        const distractor = phonicsData[letters[Math.floor(Math.random() * letters.length)]][0];
        const options = [currentTarget, distractor].sort(() => Math.random() - 0.5);
        
        document.getElementById('opt1').innerText = options[0];
        document.getElementById('opt2').innerText = options[1];
        document.getElementById('opt1').style.background = "#E3F2FD";
        document.getElementById('opt2').style.background = "#E3F2FD";
        document.getElementById('quiz-area').classList.remove('hidden');
        document.getElementById('result-area').classList.add('hidden');
        document.getElementById('playRecBtn').classList.add('hidden');
    }

    function playSound() { speak(currentTarget); }
    function speak(t) { window.speechSynthesis.cancel(); const m = new SpeechSynthesisUtterance(t); m.lang = 'en-US'; m.rate = 0.7; window.speechSynthesis.speak(m); }

    function checkAnswer(el) {
        if (el.innerText === currentTarget) {
            playDing();
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('result-area').classList.remove('hidden');
            document.getElementById('big-word').innerText = currentTarget;
            speak("Good job! Now record your voice.");
        } else {
            el.style.background = "#FFCDD2";
            speak("Try again");
        }
    }

    // ÈåÑÈü≥ÈÇèËºØ
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            audioUrl = URL.createObjectURL(audioBlob);
            document.getElementById('playRecBtn').classList.remove('hidden');
        };
    });

    function startRecording() { 
        audioChunks = []; 
        mediaRecorder.start(); 
        document.getElementById('recBtn').innerText = "üî¥";
    }
    function stopRecording() { 
        mediaRecorder.stop(); 
        document.getElementById('recBtn').innerText = "üé§";
    }
    function playBack() { new Audio(audioUrl).play(); }

    function playDing() {
        const ctx = new AudioContext(); const o = ctx.createOscillator(); const g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination); o.frequency.setValueAtTime(523, ctx.currentTime);
        o.frequency.exponentialRampToValueAtTime(659, ctx.currentTime + 0.1);
        g.gain.setValueAtTime(0.1, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
        o.start(); o.stop(ctx.currentTime + 0.3);
    }
</script>
</body>
</html>
